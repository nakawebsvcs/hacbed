---
import BaseLayout from "src/layouts/BaseLayout.astro";
import { marked } from 'marked';
import CTA from "@components/CTA.astro";
import { getCollection } from "astro:content";

// Fetch how-we-work page content
const howWeWorkContent = await getCollection("howWeWork");
const howWeWorkPage = howWeWorkContent[0];

// Parse markdown to HTML
const facilitationContentHtml = marked.parse(howWeWorkPage.data.facilitationContent);
const facilitationExamplesHtml = marked.parse(howWeWorkPage.data.facilitationExamples);
const networkContentHtml = marked.parse(howWeWorkPage.data.networkContent);
const networkExamplesHtml = marked.parse(howWeWorkPage.data.networkExamples);
const planningContentHtml = marked.parse(howWeWorkPage.data.planningContent);
const planningExamplesHtml = marked.parse(howWeWorkPage.data.planningExamples);
const howWeWorkIntroHtml = marked.parse(howWeWorkPage.data.howWeWorkIntro);
---

<BaseLayout
  title="How We Work"
  description="Meta description for the page"
>
  <!-- Custom hero/banner section -->
  <section class="page-header">
  <div class="full-width-image-container">
    <img src="/assets/images/About-Page.png" alt="About page header" />
    <div class="header-overlay">
      <h1 class="header-title">HOW WE WORK</h1>
    </div>
  </div>
</section>


  <!-- ============================================ -->
<!--                  Content                     -->
<!-- ============================================ -->

<section id="content-1450">
    <div class="cs-container">
        <div class="cs-content">
           <!--  <span class="cs-topper">ABOUT US</span> 
            <h2 class="cs-title">About</h2> -->
            <p class="cs-text">
                HACBED uplifts community voice and supports collective action towards community-based economic development as a facilitator, catalyst, community builder and broker as asked by the communities we serve. Our approach  is founded on the belief that people "know" and "can" and is conducted through informed and skilled listening that strengthens community voice and promotes collective action. Please click the images below to learn more about how we do our work.</p>
        </div>
    </div>
</section>

<!-- ============================================ -->
<!--                    Services                  -->
<!-- ============================================ -->

<section id="services-1727" style="margin-top: -8rem;">
    <div class="cs-container">
        <ul class="cs-card-group">
            <li class="cs-item">
                <a href="#facilitation" class="cs-link">
                    <h3 class="cs-h3">Facilitation</h3>
                </a>
                <picture class="cs-background">
                    <source media="(max-width: 600px)" srcset="/assets/images/facilitation.jpg">
                    <source media="(min-width: 601px)" srcset="/assets/images/facilitation.jpg">
                    <img decoding="async" loading="lazy" src="/assets/images/facilitation.jpg" alt="group of people" width="413" height="320" aria-hidden="true">
                </picture>
            </li>
            <li class="cs-item">
                <a href="#networkcoordination" class="cs-link">
                    <h3 class="cs-h3">Network Coordination and Development</h3>
                </a>
                <picture class="cs-background">
                    <source media="(max-width: 600px)" srcset="/assets/images/networkcoordination.jpg">
                    <source media="(min-width: 601px)" srcset="/assets/images/networkcoordination.jpg">
                    <img decoding="async" loading="lazy" src="/assets/images/networkcoordination.jpg" alt="people working together in a room" width="413" height="320" aria-hidden="true">
                </picture>
            </li>
            <li class="cs-item">
                <a href="#strategicplanning" class="cs-link">
                    <h3 class="cs-h3">Strategic Planning and Technical Assistance</h3>
                </a>
                <picture class="cs-background">
                    <source media="(max-width: 600px)" srcset="/assets/images/strategicplanning.jpg">
                    <source media="(min-width: 601px)" srcset="/assets/images/strategicplanning.jpg">
                    <img decoding="async" loading="lazy" src="/assets/images/strategicplanning.jpg" alt="table workspace" width="413" height="320" aria-hidden="true">
                </picture>
            </li>
        </ul>
    </div>
</section>

<!-- ============================================ -->
<!--                 Side By Side                 -->
<!-- ============================================ -->

<section id="sbs-1024" style="margin-top: -5rem;">
  <div class="cs-container" id="facilitation">
    <!-- Keep the picture section the same -->
    <div class="cs-image-group">
      <picture class="cs-picture">
        <source media="(max-width: 600px)" srcset="/assets/images/facilitation.jpg">
        <source media="(min-width: 601px)" srcset="/assets/images/facilitation.jpg">
        <img loading="lazy" decoding="async" src="/assets/images/facilitation.jpg" alt="facilitation" width="1280" height="568">
      </picture>
    </div>
    
    <!-- Restructure the content section -->
    <div class="cs-content">
      <!-- Left column -->
      <div class="cs-content-col">
        <h2 class="cs-title">Facilitation</h2>
        <div class="cs-text-wrapper">
          <div class="cs-text markdown-content" set:html=
             {facilitationContentHtml}>
        </div>
        </div>
      </div>
      
      <!-- Right column -->
      <div class="cs-content-col">
        <h2 class="cs-title">Examples of Our Work</h2>
        <div class="cs-text-wrapper">
          <div class="cs-text markdown-content" set:html={facilitationExamplesHtml}></div>
          <a href="/contact" class="cs-button-solid">Work With Us</a>
        </div>
      </div>
    </div>
  </div>

  <!--Network Coordination and Development-->

  <div class="cs-container" style="margin-top: 8rem;" id="networkcoordination">
    <div class="cs-image-group">
      <picture class="cs-picture">
        <source media="(max-width: 600px)" srcset="/assets/images/networkcoordination.jpg">
        <source media="(min-width: 601px)" srcset="/assets/images/networkcoordination.jpg">
        <img loading="lazy" decoding="async" src="/assets/images/networkcoordination.jpg" alt="strategic planning" width="1280" height="568">
      </picture>
    </div>
    
    <div class="cs-content">
      <!-- Left column -->
      <div class="cs-content-col">
        <h2 class="cs-title">Network Coordination and Development</h2>
        <div class="cs-text-wrapper">
           <div class="cs-text markdown-content" set:html={networkContentHtml}></div>
        </div>
      </div>
      
      <!-- Right column -->
      <div class="cs-content-col">
        <h2 class="cs-title">Examples of Our Work</h2>
        <div class="cs-text-wrapper">
          <div class="cs-text markdown-content" set:html={networkExamplesHtml}></div>
          <a href="/contact" class="cs-button-solid">Work With Us</a>
        </div>
      </div>
    </div>
  </div>

  <!--Strategic Planning and Technical Assistance-->

  <div class="cs-container" style="margin-top: 8rem;" id="strategicplanning">
    <div class="cs-image-group">
       <picture class="cs-picture">
        <source media="(max-width: 600px)" srcset="/assets/images/strategicplanning.jpg">
        <source media="(min-width: 601px)" srcset="/assets/images/strategicplanning.jpg">
        <img loading="lazy" decoding="async" src="/assets/images/strategicplanning.jpg" alt="strategic planning" width="1280" height="568" style="object-position: center 30% !important;">
      </picture>
    </div>
    
    <div class="cs-content">
      <!-- Left column -->
      <div class="cs-content-col">
        <h2 class="cs-title">Strategic Planning and Technical Assistance</h2>
        <div class="cs-text-wrapper">
           <div class="cs-text markdown-content" set:html={planningContentHtml}></div>
        </div>
      </div>
      
      <!-- Right column -->
      <div class="cs-content-col">
        <h2 class="cs-title">Examples of Our Work</h2>
        <div class="cs-text-wrapper">
         <div class="cs-text markdown-content" set:html={planningExamplesHtml}></div>
          <a href="/contact" class="cs-button-solid">Work With Us</a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Back to Top Button -->
  <button id="back-to-top" aria-label="Back to top">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
      <path fill="none" d="M0 0h24v24H0z"/>
      <path d="M12 10.828l-4.95 4.95-1.414-1.414L12 8l6.364 6.364-1.414 1.414z" fill="currentColor"/>
    </svg>
  </button>

                                

  <CTA />
</BaseLayout>

<style is:global lang="less">
  /* PAGE-SPECIFIC STYLES FOR THE PAGE */

/*-- -------------------------- -->
<---       Custom Landing      -->
<--- -------------------------- -*/

/* Mobile - 360px */
@media only screen and (min-width: 0rem) {
  .page-header {
    padding: 0; /* Remove padding as we want full-width */
    margin-top: 60px; /* Add margin to push content below navbar */
    
    .full-width-image-container {
      position: relative;
      width: 100vw;
      height: 50vh; /* Significantly increased height */
      overflow: hidden;
      
      img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: 60% center; /* Keep focus on top */
        display: block;
      }
      
      .header-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(0, 0, 0, 0.4);
      }
      
      .header-title {
        color: var(--primary);
        text-align: center;
        margin: 0;
        padding: 0 1rem;
        font-size: var(--headerFontSize, 2.5rem);
        font-weight: 700;
        line-height: 1.2em;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.6);
      }
    }
  }
}

/* Large screens (desktops and tablets) */
@media only screen and (min-width: 768px) {
  .page-header {
    .full-width-image-container {
      height: 80vh; /* Significantly increased height */
      
      .header-title {
        font-size: 4rem;
      }
    }
  }
}

/* Extra Large screens (wide desktops) */
@media only screen and (min-width: 1200px) {
  .page-header {
    .full-width-image-container {
      height: 70vh; /* Significantly increased height */
    }

    .header-title {
      font-size: 5rem;
    }
  }
}

  /*-- -------------------------- -->
<---          Content           -->
<--- -------------------------- -*/

/* Mobile - 360px */
@media only screen and (min-width: 0rem) {
    #content-1450 {
        padding: var(--sectionPadding);
        
        .cs-container {
            width: 100%;
            max-width: (1200/16rem);
            margin: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* 48px - 64px */
            gap: clamp(3rem, 6vw, 4rem);
        }

        .cs-content {
            /* set text align to left if content needs to be left aligned */
            text-align: left;
            width: 100%;
            display: flex;
            flex-direction: column;
            /* centers content horizontally, set to flex-start to left align */
            align-items: center;

             ul {
                width: 100%;
                max-width: 100%;
                margin: 0 0 (24/16rem) 0;
                padding-left: (24/16rem);
                list-style-position: outside;
                
                li {
                  font-size: clamp(.9rem, 1.8vw, 1.05rem);
                  line-height: 1.5em;
                  color: var(--bodyTextColor);
                  margin-bottom: (8/16rem);
                  position: relative;
                  padding-left: (4/16rem);
                  
                  &::marker {
                    color: var(--primary); // Use your brand color for bullets
                  }
                  
                  // For nested lists
                  ul {
                    margin: (8/16rem) 0 (8/16rem) 0;
                    
                    li {
                      font-size: 0.95em; // Slightly smaller than parent
                    }
      }
    }
  }
}
  
  // Add styling for ordered lists too
  ol {
    width: 100%;
    max-width: 100%;
    margin: 0 0 (24/16rem) 0;
    padding-left: (24/16rem);
    list-style-position: outside;
    counter-reset: item;
    
    li {
      font-size: clamp(.9rem, 1.8vw, 1.05rem);
      line-height: 1.5em;
      color: var(--bodyTextColor);
      margin-bottom: (8/16rem);
      position: relative;
      padding-left: (4/16rem);
      
      &::marker {
        color: var(--secondary);
      }
    }
  }

        .cs-title, .cs-text {
            max-width: 100%;
        }

        .cs-text {
            /* 16px - 20px */
            font-size: clamp(1.2rem, 1.8vw, 1.2rem);
            margin: 0 0 (32/16rem) 0;
        }
    }
}

/*-- -------------------------- -->
<---       Side By Side         -->
<--- -------------------------- -*/

/* Mobile - 360px */
@media only screen and (min-width: 0rem) {
  #sbs-1024 {
    padding: var(--sectionPadding);

    .cs-container {
      width: 100%;
      max-width: (1280/16rem);
      margin: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: (48/16rem);
    }

    .cs-content {
      text-align: left;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: (32/16rem);
    }
    
    .cs-content-col {
      width: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .cs-text-wrapper {
      display: flex;
      flex-direction: column;
      gap: (16/16rem);
    }

    .cs-title {
      font-size: clamp(1.5rem, 4vw, 2rem);
      margin-bottom: (16/16rem);
      color: var(--secondary);
    }

    .cs-text {
      margin: 0;
      font-size: clamp(.9rem, 1.8vw, 1.05rem);
      line-height: 1.5;
    }

    .in-text-link {
      text-decoration: none;
      color: var(--secondary);
      font-style: italic;
    }
    
    .cs-list {
      width: 100%;
      margin: 0;
      padding-left: (24/16rem);
      list-style-position: outside;
      
      li {
        font-size: clamp(.9rem, 1.8vw, 1.05rem);
        line-height: 1.5em;
        color: var(--bodyTextColor);
        margin-bottom: (8/16rem);
        
        &::marker {
          color: var(--primary);
        }
      }
    }

    .cs-button-solid {
      font-size: (16/16rem);
      line-height: clamp(2.875rem, 5.5vw, 3.5rem);
      text-decoration: none;
      font-weight: 700;
      text-align: center;
      color: var(--secondary);
      min-width: (150/16rem);
      padding: 0 (32/16rem);
      background-color: var(--primary);
      display: inline-block;
      position: relative;
      margin-top: (16/16rem);
      align-self: center;
      z-index: 1;
      box-sizing: border-box;

      &:before {
        content: "";
        position: absolute;
        height: 100%;
        width: 0%;
        background: var(--secondary);
        opacity: 1;
        top: 0;
        left: 0;
        z-index: -1;
        transition: width 0.3s;
      }

      &:hover {
        color: #fff;
        &:before {
          width: 100%;
        }
      }
    }

    .cs-image-group {
      width: 100%;
      margin-bottom: (32/16rem);
      position: relative;
    }

    .cs-picture {
      width: 100%;
      height: 67vw;
      max-height: (480/16rem);
      display: block;
      position: relative;

      img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.4);
        top: 0;
        left: 0;
      }
    }
  }
}

/* Tablet - 768px */
@media only screen and (min-width: 48rem) {
  #sbs-1024 {
    .cs-content {
      flex-direction: row;
      gap: (48/16rem);
    }
    
    .cs-content-col {
      width: 50%;
    }
    
    .cs-title {
      margin-bottom: (24/16rem);
    }
  }
}


/*-- -------------------------- -->
<---          Services          -->
<--- -------------------------- -*/

/* Mobile - 360px */
@media only screen and (min-width: 0rem) {
    #services-1727 {
        padding: var(--sectionPadding);
        position: relative;
        margin-top: -4rem;

        .cs-container {
            width: 100%;
            max-width: (1280/16rem);
            margin: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: clamp(3rem, 6vw, 4rem);
        }

        .cs-content {
            /* set text align to left if content needs to be left aligned */
            text-align: center;
            width: 100%;
            display: flex;
            flex-direction: column;
            /* centers content horizontally, set to flex-start to left align */
            align-items: center;
        }

        .cs-title {
            max-width: 25ch;
        }

        .cs-card-group {
            width: 100%;
            margin: 0;
            padding: 0;
            display: grid;
            align-items: stretch;
            grid-template-columns: repeat(12, 1fr);
            /* 16px - 20px */
            gap: clamp(1rem, 2vw, 1.25rem);
        }

        .cs-item {
            text-align: center;
            list-style: none;
            width: 100%;
            /* 240px - 320px */
            height: clamp(15rem, 40vw, 20rem);
            margin: 0;
            /* prevents padding and border from affecting height and width */
            box-sizing: border-box;
            padding: 0;
            background-color: #000;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: flex-start;
            grid-column: span 12;
            grid-row: span 1;
            position: relative;
            z-index: 1;
            overflow: hidden;

            &:hover .cs-background:before {
                opacity: 0.8;
            }

            &:hover .cs-background img {
                transform: scale(1.2);
            }
        }

        .cs-link {
            text-decoration: none;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            /* padding goes on the link, not the cs-item as is normal. We do this because we want the whole card to be hoverable. So we add the padding to the link tag to create the space inside the card. By adding the space inside the cs-link tag we can make the whole card hoverable since the padding is now contributing to the height and width of the link */
            /* 16px - 32px */
            padding: clamp(1rem, 3vw, 2rem);
            /* prevents padding from affecting height and width */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: flex-start;
        }

        .cs-number {
            font-size: (84/16rem);
            font-weight: 900;
            color: rgba(0, 0, 0, 0);
            opacity: 100%;
            position: absolute;
            /* 16px - 32px */
            right: clamp(1rem, 3vw, 2rem);
            bottom: clamp(1rem, 3vw, 2rem);
            transition: opacity 0.3s, top 0.3s;
            -webkit-text-stroke-width: 1px;
            -webkit-text-stroke-color: var(--bodyTextColorWhite);
        }

        .cs-h3 {
            /* 25px - 31px */
            font-size: clamp(1.5625rem, 2.5vw, 1.9375rem);
            font-weight: 700;
            line-height: 1.2em;
            text-align: inherit;
            margin: 0;
            color: var(--bodyTextColorWhite);
        }

        .cs-background {
            width: 100%;
            height: 100%;
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1;

            &:before {
                /* background color overlay */
                content: "";
                width: 100%;
                height: 100%;
                background-color: #000;
                opacity: 0.4;
                display: block;
                position: absolute;
                top: 0;
                left: 0;
                z-index: 1;
                transition: background-color 0.3s, opacity 0.3s;
            }

            img {
                width: 100%;
                height: 100%;
                /* Makes img tag act as a background image */
                object-fit: cover;
                position: absolute;
                top: 0;
                left: 0;
                transition: transform 0.6s;
            }
        }
    }
}

/* Tablet - 768px */
@media only screen and (min-width: 48rem) {
    #services-1727 {
      margin-top: -6rem;
        .cs-item {
            grid-column: span 4;
        }
    }
}

/*-- -------------------------- -->
<---       Markdown Content         -->
<--- -------------------------- -*/

.markdown-content {
  /* Style for paragraphs */
  p {
    font-size: clamp(.9rem, 1.8vw, 1.05rem);
    line-height: 1.5;
    color: var(--bodyTextColor);
    margin-bottom: (16/16rem);
  }
  
  /* Style for unordered lists - matching your existing ul styling in #content-1450 */
  ul {
    width: 100%;
    max-width: 100%;
    margin: 0 0 (24/16rem) 0;
    padding-left: (24/16rem);
    list-style-position: outside;
    
    li {
      font-size: clamp(.9rem, 1.8vw, 1.05rem);
      line-height: 1.5em;
      color: var(--bodyTextColor);
      margin-bottom: (8/16rem);
      position: relative;
      padding-left: (4/16rem);
      
      &::marker {
        color: var(--primary);
      }
      
      /* For nested lists */
      ul {
        margin: (8/16rem) 0 (8/16rem) 0;
        
        li {
          font-size: 0.95em;
        }
      }
    }
  }
  
  /* Style for ordered lists - matching your existing ol styling */
  ol {
    width: 100%;
    max-width: 100%;
    margin: 0 0 (24/16rem) 0;
    padding-left: (24/16rem);
    list-style-position: outside;
    counter-reset: item;
    
    li {
      font-size: clamp(.9rem, 1.8vw, 1.05rem);
      line-height: 1.5em;
      color: var(--bodyTextColor);
      margin-bottom: (8/16rem);
      position: relative;
      padding-left: (4/16rem);
      
      &::marker {
        color: var(--secondary);
      }
    }
  }
  
  /* Style for links - matching your .in-text-link style from #sbs-1024 */
  a {
    text-decoration: none;
    color: var(--secondary);
    font-style: italic;
    
    &:hover {
      text-decoration: underline;
    }
  }
  
  /* Style for strong/bold text */
  strong, b {
    font-weight: 700;
    color: var(--bodyTextColor);
  }
  
  /* Style for emphasis/italic text */
  em, i {
    font-style: italic;
    color: var(--bodyTextColor);
  }
}

/*-- -------------------------- -->
<---          BTT Button         -->
<--- -------------------------- -*/

/* Back to Top Button Styles */

@media only screen and (max-width: 48rem) {
  #back-to-top {
    bottom: 1rem;
    right: 1rem;
    width: 2.5rem;
    height: 2.5rem;
    z-index: 1000; /* Ensure it's above all other elements */
  }
}
  #back-to-top {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background-color: var(--primary);
    color: var(--secondary);
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
    z-index: 100;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);

    &:hover {
      background-color: var(--secondary);
      color: #fff;
    }

    &.visible {
      opacity: 1;
      visibility: visible;
    }

    svg {
      width: 1.5rem;
      height: 1.5rem;
    }
  }
                                
  </style>
  
  <script>
function initializeBackToTop() {
  const backToTopButton = document.getElementById('back-to-top');
  const facilitationSection = document.getElementById('facilitation');
  
  if (backToTopButton && facilitationSection) {
    // Function to check scroll position and show/hide button
    function toggleBackToTopButton() {
      const facilitationPosition = facilitationSection.getBoundingClientRect().top;
      
      // Show button when facilitation section reaches top of viewport
      if (facilitationPosition <= 0) {
        backToTopButton.classList.add('visible');
      } else {
        backToTopButton.classList.remove('visible');
      }
    }
    
    // Add scroll event listener
    window.addEventListener('scroll', toggleBackToTopButton);
    
    // Initial check in case page is loaded already scrolled
    toggleBackToTopButton();
    
    // Add click event to scroll back to top
    backToTopButton.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
  }
}

// Run on all possible events
document.addEventListener('DOMContentLoaded', initializeBackToTop);
document.addEventListener('astro:page-load', initializeBackToTop);
document.addEventListener('astro:after-swap', initializeBackToTop);

// Set up MutationObserver
const observer = new MutationObserver((mutations) => {
  for (const mutation of mutations) {
    if (mutation.addedNodes.length) {
      if (document.getElementById('back-to-top') && 
          document.getElementById('facilitation')) {
        initializeBackToTop();
      }
    }
  }
});

// Start observing
observer.observe(document.body, { childList: true, subtree: true });
</script>